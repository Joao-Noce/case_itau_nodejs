<div class="layout">
  
  <div class="main-content">
    <header class="topo">
      <h1>Configuração de Usuário</h1>
    </header>

    <div *ngIf="carregando" class="loading">
      <p>Carregando usuário...</p>
    </div>

    <div *ngIf="!carregando && cliente" class="cliente-container">

      <div class="info-container">
        <div class="user-info">
          <div class="content-container">
            <div class="content">
              <h2>Nome:</h2>
              <p> {{ cliente?.nome }}</p>
            </div>
            <div class="content">
              <h2>Email:</h2>
              <p> {{ cliente?.email }}</p>
            </div>
          </div>
          <div class="menu-dots" (click)="toggleMenu()">
            &#x22EE;
            <div class="dropdown" *ngIf="menuAberto">
              <button (click)="abrirModalAtualizarCliente(); menuAberto=false">Editar</button>
              <button (click)="abrirModalRemoverCliente(); menuAberto=false">Remover</button>
            </div>
          </div>
        </div>

        <div class="saldo-box">
          <span class="material-icons money-icon">monetization_on</span>
          <div class="content-container">
            <h2>
              Saldo Atual
            </h2>
            <p>{{ cliente.saldo | currency:'BRL' }}</p>
          </div>
        </div>

        <div class="grafico-saldos">
          <app-grafico-saldo-mensal [dadosGraficoSaldo]="dadosGraficoSaldosMensais">
          </app-grafico-saldo-mensal>
        </div>
      </div>

      <div class="resumo-investimento">
        <div class="resumo-item entrada">
          <span>
            <span class="material-icons icon entrada-icon">arrow_upward</span>
            Entrada Fixa Total
          </span>
          <strong>{{ entradaTotal | currency:'BRL' }}</strong>
        </div>
        <div class="resumo-item saida">
          <span>
            <span class="material-icons icon saida-icon">arrow_downward</span>
            Saída Fixa Total
          </span>
          <strong>{{ saidaTotal | currency:'BRL' }}</strong>
        </div>
        <div class="resumo-item saldo">
          <span>
            <span class="material-icons icon saldo-icon">account_balance_wallet</span>
            Saldo Fixo Final
          </span>
          <strong>{{ saldoFinal | currency:'BRL' }}</strong>
        </div>
      </div>

      <div class="tabela-container">
        <h3 (click)="toggleTabela(1)">
          <p>Valores Fixos</p>
          <span class="arrow" [class.aberta]="tabela1Aberta">▶</span>
        </h3>

        <div class="tabela-actions">
          <button class="btn-crear" (click)="abrirModalAdicionarRegistro()">
            <span class="material-icons">add</span> Novo Registro
          </button>
        </div>

        <div class="conteudo" [class.aberta]="tabela1Aberta">
          <div class="tabelas">
            <div class="tabela">
              <h4>Entradas</h4>
              <ng-container *ngIf="!carregando; else carregandoFixosEntrada">
                <table *ngIf="entradas?.length; else semFixosEntrada">
                  <thead>
                    <tr>
                      <th>Descrição</th>
                      <th>Valor</th>
                      <th>Data</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let f of entradas">
                      <td>{{ f.descricao }}</td>
                      <td>{{ f.valor | currency:'BRL' }}</td>
                      <td>{{ f.data | date:'shortDate' }}</td>
                      <td class="btn-container">
                        <button class="btn-edit" (click)="abrirModalAtualizarRegistro(f)"><span
                            class="material-icons icon saida-icon">edit</span></button>
                        <button class="btn-delete" (click)="abrirModalRemoverRegistro(f)"><span
                            class="material-icons icon saida-icon">delete</span></button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </ng-container>
            </div>

            <div class="tabela">
              <h4>Saídas</h4>
              <ng-container *ngIf="!carregando; else carregandoFixosSaida">
                <table *ngIf="saidas?.length; else semFixosSaida">
                  <thead>
                    <tr>
                      <th>Descrição</th>
                      <th>Valor</th>
                      <th>Data</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let f of saidas">
                      <td>{{ f.descricao }}</td>
                      <td>{{ f.valor | currency:'BRL' }}</td>
                      <td>{{ f.data | date:'shortDate' }}</td>
                      <td class="btn-container">
                        <button class="btn-edit" (click)="abrirModalAtualizarRegistro(f)"><span
                            class="material-icons icon saida-icon">edit</span></button>
                        <button class="btn-delete" (click)="abrirModalRemoverRegistro(f)"><span
                            class="material-icons icon saida-icon">delete</span></button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </ng-container>
            </div>
          </div>
          <ng-template #carregandoFixosSaida>
            <p>Carregando valores...</p>
          </ng-template>
          <ng-template #semFixosSaida>
            <p>Ainda não há saídas fixas...</p>
          </ng-template>

          <ng-template #carregandoFixosEntrada>
            <p>Carregando valores...</p>
          </ng-template>
          <ng-template #semFixosEntrada>
            <p>Ainda não há entradas fixas...</p>
          </ng-template>
        </div>
      </div>

      <div class="tabela-container">
        <h3 (click)="toggleTabela(2)">
          <p>Categorias Personalizadas</p>
          <span class="arrow" [class.aberta]="tabela2Aberta">▶</span>
        </h3>

        <div class="tabela-actions">
          <button class="btn-crear" (click)="abrirModalAdicionarCategoria()">
            <span class="material-icons">add</span> Nova Categoria
          </button>
        </div>

        <div class="conteudo" [class.aberta]="tabela2Aberta">
          <div class="tabelas">
            <div class="tabela">
              <ng-container *ngIf="!carregando; else carregandoCategorias">
                <table *ngIf="categorias?.length; else semDados">
                  <thead>
                    <tr>
                      <th>Categoria</th>
                      <th>Personalizado</th>
                      <th>Ação</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let c of categorias">
                      <td>{{ c.nome }}</td>
                      <td>{{ c.fkCliente ? 'Sim' : 'Não' }}</td>
                      <td class="btn-container">
                        <button class="btn-edit" (click)="abrirModalAtualizarCategoria(c)"
                          [disabled]="c.fkCliente == null"><span
                            class="material-icons icon saida-icon">edit</span></button>
                        <button class="btn-delete" (click)="abrirModalRemoverCategoria(c)"
                          [disabled]="c.fkCliente == null"><span
                            class="material-icons icon saida-icon">delete</span></button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </ng-container>
            </div>
            <ng-template #carregandoCategorias>
              <p>Carregando categorias...</p>
            </ng-template>

            <ng-template #semDados>
              <p>Ainda não há categorias...</p>
            </ng-template>
            <div class="categorias-grafico">
              <div class="grafico-pizza">
                <app-grafico-categorias [dadosGraficoCategoria]="dadosGraficoCategoria"></app-grafico-categorias>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--? CLIENTE -->
<app-modal [titulo]="'Remover Cliente?'" [mostrar]="mostrarModalRemoverCliente"
  (fechar)="mostrarModalRemoverCliente = false" (confirmar)="confirmarRemoverCliente()">
  <p>Você tem certeza que deseja remover o cliente <strong>{{ cliente?.nome }}</strong>?</p>
</app-modal>

<app-modal [titulo]="'Atualizar Cliente'" [mostrar]="mostrarModalAtualizarCliente"
  (fechar)="mostrarModalAtualizarCliente = false" (confirmar)="confirmarAtualizarCliente()">
  <form (ngSubmit)="confirmarAtualizarCliente()" #formAtualizarCliente="ngForm">
    <label> Nome: <input type="text" [(ngModel)]="formCliente.nome" name="nome" required> </label>
    <label> Email: <input type="email" [(ngModel)]="formCliente.email" name="email" required> </label>
  </form>
</app-modal>

<!--? REGISTRO -->
<app-modal [titulo]="'Adicionar Registro'" [mostrar]="mostrarModalAdicionarRegistro"
  (fechar)="mostrarModalAdicionarRegistro = false" (confirmar)="confirmarAdicionarRegistro()">
  <form (ngSubmit)="confirmarAdicionarRegistro()" #formAdicionarRegistro="ngForm">

    <label>
      Descrição:
      <input type="text" [(ngModel)]="formRegistro.descricao" name="descricao" required />
    </label>

    <label>
      Valor:
      <input type="number" step="0.01" [(ngModel)]="formRegistro.valor" name="valor" required />
    </label>

    <label>
      Data:
      <input type="date" [(ngModel)]="formRegistro.data" name="data" required />
    </label>

    <label>
      Tipo:
      <select [(ngModel)]="formRegistro.tipo" name="tipo" required>
        <option value="Deposito">Depósito</option>
        <option value="Saque">Saque</option>
      </select>
    </label>

    <label>
      Repetição:
      <select [(ngModel)]="formRegistro.repeticao" name="repeticao" required>
        <option value="DAY">Diária</option>
        <option value="WEEK">Semanal</option>
        <option value="MONTH">Mensal</option>
        <option value="YEAR">Anual</option>
      </select>
    </label>

    <label>
      Categoria:
      <select [(ngModel)]="formRegistro.fkCategoria" name="fkCategoria">
        <option [ngValue]="null">Sem categoria</option>
        <option *ngFor="let categoria of categorias" [ngValue]="categoria.idCategoria">
          {{ categoria.nome }}
        </option>
      </select>
    </label>

  </form>
</app-modal>

<app-modal [titulo]="'Atualizar Registro'" [mostrar]="mostrarModalAtualizarRegistro"
  (fechar)="mostrarModalAtualizarRegistro = false" (confirmar)="confirmarAtualizarRegistro()">
  <form (ngSubmit)="confirmarAtualizarRegistro()" #formAtualizarRegistro="ngForm">

    <label>
      Descrição:
      <input type="text" [(ngModel)]="formRegistro.descricao" name="descricao" required />
    </label>

    <label>
      Valor:
      <input type="number" step="0.01" [(ngModel)]="formRegistro.valor" name="valor" required />
    </label>

    <label>
      Data:
      <input type="date" [(ngModel)]="formRegistro.data" name="data" required />
    </label>

    <label>
      Tipo:
      <select [(ngModel)]="formRegistro.tipo" name="tipo" required>
        <option value="Deposito">Depósito</option>
        <option value="Saque">Saque</option>
      </select>
    </label>

    <label>
      Repetição:
      <select [(ngModel)]="formRegistro.repeticao" name="repeticao" required>
        <option value="NONE">Nenhuma</option>
        <option value="DAY">Diária</option>
        <option value="WEEK">Semanal</option>
        <option value="MONTH">Mensal</option>
        <option value="YEAR">Anual</option>
      </select>
    </label>

    <label>
      Categoria:
      <select [(ngModel)]="formRegistro.fkCategoria" name="fkCategoria">
        <option [ngValue]="null">Sem categoria</option>
        <option *ngFor="let categoria of categorias" [ngValue]="categoria.idCategoria">
          {{ categoria.nome }}
        </option>
      </select>
    </label>

  </form>
</app-modal>

<app-modal [titulo]="'Remover Registro?'" [mostrar]="mostrarModalRemoverRegistro"
  (fechar)="mostrarModalRemoverRegistro = false" (confirmar)="confirmarRemoverRegistro()">
  <p>Você tem certeza que deseja remover o registro de <strong>{{ registro?.descricao }}</strong>?</p>
</app-modal>


<!--? CATEGORIA -->
<app-modal [titulo]="'Remover Categoria?'" [mostrar]="mostrarModalRemoverCategoria"
  (fechar)="mostrarModalRemoverCategoria = false" (confirmar)="confirmarRemoverCategoria()">
  <p>Você tem certeza que deseja remover a categoria <strong>{{ categoria?.nome }}</strong>?</p>
</app-modal>

<app-modal [titulo]="'Atualizar Categoria'" [mostrar]="mostrarModalAtualizarCategoria"
  (fechar)="mostrarModalAtualizarCategoria = false" (confirmar)="confirmarAtualizarCategoria()">
  <form (ngSubmit)="confirmarAtualizarCategoria()" #formAtualizarCategoria="ngForm">

    <label>
      Nome:
      <input type="text" [(ngModel)]="formCategoria.nome" name="nome" required />
    </label>
  </form>
</app-modal>

<app-modal [titulo]="'Adicionar Categoria'" [mostrar]="mostrarModalAdicionarCategoria"
  (fechar)="mostrarModalAdicionarCategoria = false" (confirmar)="confirmarAdicionarCategoria()">
  <form (ngSubmit)="confirmarAdicionarCategoria()" #formAdicionarCategoria="ngForm">

    <label>
      Nome:
      <input type="text" [(ngModel)]="formCategoria.nome" name="nome" required />
    </label>
  </form>
</app-modal>

<app-modal [titulo]="modalTitulo" [mostrar]="mostrarModalAvisar" [autoCloseTime]="autoClose"
  (fechar)="mostrarModalAvisar = false">
  <p>{{ modalMensagem }}</p>
</app-modal>